using AspNetSandBox.Controllers;
using System;
using Xunit;

namespace AspNetSandBox.Tests
{
    public class WeatherForecastControllerTest
    {
        [Fact]
        public void ConvertResponseToWeatherForecastTest()
        {
            //Assume

            string content = "{\"lat\":46.476,\"lon\":24.0934,\"timezone\":\"Europe/Bucharest\",\"timezone_offset\":10800,\"current\":{\"dt\":1630565290,\"sunrise\":1630554308,\"sunset\":1630602115,\"temp\":287.41,\"feels_like\":286.9,\"pressure\":1020,\"humidity\":77,\"dew_point\":283.44,\"uvi\":1.87,\"clouds\":75,\"visibility\":10000,\"wind_speed\":4.63,\"wind_deg\":310,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}]},\"daily\":[{\"dt\":1630576800,\"sunrise\":1630554308,\"sunset\":1630602115,\"moonrise\":1630534440,\"moonset\":1630594320,\"moon_phase\":0.84,\"temp\":{\"day\":290.31,\"min\":284.93,\"max\":293.15,\"night\":284.93,\"eve\":290.83,\"morn\":285.69},\"feels_like\":{\"day\":289.62,\"night\":284.04,\"eve\":289.99,\"morn\":285.17},\"pressure\":1020,\"humidity\":59,\"dew_point\":282.24,\"wind_speed\":9.08,\"wind_deg\":318,\"wind_gust\":11.44,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"clouds\":90,\"pop\":0.05,\"uvi\":4.53},{\"dt\":1630663200,\"sunrise\":1630640785,\"sunset\":1630688400,\"moonrise\":1630624200,\"moonset\":1630683300,\"moon_phase\":0.88,\"temp\":{\"day\":293.21,\"min\":282.1,\"max\":295.34,\"night\":287.04,\"eve\":292.64,\"morn\":282.1},\"feels_like\":{\"day\":292.45,\"night\":286.29,\"eve\":292,\"morn\":282.1},\"pressure\":1021,\"humidity\":45,\"dew_point\":280.57,\"wind_speed\":3.79,\"wind_deg\":340,\"wind_gust\":4.45,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"clouds\":1,\"pop\":0,\"uvi\":5.72},{\"dt\":1630749600,\"sunrise\":1630727261,\"sunset\":1630774684,\"moonrise\":1630714500,\"moonset\":1630771860,\"moon_phase\":0.91,\"temp\":{\"day\":295.92,\"min\":283.74,\"max\":297.5,\"night\":291.92,\"eve\":294.61,\"morn\":283.74},\"feels_like\":{\"day\":295.35,\"night\":291.21,\"eve\":294.01,\"morn\":283.05},\"pressure\":1017,\"humidity\":42,\"dew_point\":282.27,\"wind_speed\":1.43,\"wind_deg\":167,\"wind_gust\":3.22,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"clouds\":0,\"pop\":0,\"uvi\":5.46},{\"dt\":1630836000,\"sunrise\":1630813736,\"sunset\":1630860968,\"moonrise\":1630805040,\"moonset\":1630860060,\"moon_phase\":0.94,\"temp\":{\"day\":294.26,\"min\":287.94,\"max\":297.01,\"night\":291.98,\"eve\":294.4,\"morn\":287.94},\"feels_like\":{\"day\":293.71,\"night\":291.3,\"eve\":293.78,\"morn\":287.2},\"pressure\":1019,\"humidity\":49,\"dew_point\":282.68,\"wind_speed\":3.36,\"wind_deg\":86,\"wind_gust\":6.13,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"clouds\":61,\"pop\":0.06,\"uvi\":5.18},{\"dt\":1630922400,\"sunrise\":1630900212,\"sunset\":1630947251,\"moonrise\":1630895940,\"moonset\":1630948020,\"moon_phase\":0.98,\"temp\":{\"day\":290.07,\"min\":285,\"max\":294.89,\"night\":290.55,\"eve\":294.36,\"morn\":285},\"feels_like\":{\"day\":289.18,\"night\":289.73,\"eve\":293.74,\"morn\":283.91},\"pressure\":1024,\"humidity\":52,\"dew_point\":279.8,\"wind_speed\":3.89,\"wind_deg\":135,\"wind_gust\":7.86,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"clouds\":100,\"pop\":0.06,\"uvi\":4.42},{\"dt\":1631008800,\"sunrise\":1630986688,\"sunset\":1631033533,\"moonrise\":1630986840,\"moonset\":1631035740,\"moon_phase\":0,\"temp\":{\"day\":293.74,\"min\":284.1,\"max\":297.19,\"night\":292.56,\"eve\":296.48,\"morn\":284.1},\"feels_like\":{\"day\":293.03,\"night\":291.6,\"eve\":295.7,\"morn\":283.21},\"pressure\":1024,\"humidity\":45,\"dew_point\":281.18,\"wind_speed\":2.1,\"wind_deg\":186,\"wind_gust\":1.95,\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"clear sky\",\"icon\":\"01d\"}],\"clouds\":3,\"pop\":0,\"uvi\":5},{\"dt\":1631095200,\"sunrise\":1631073164,\"sunset\":1631119815,\"moonrise\":1631077800,\"moonset\":1631123460,\"moon_phase\":0.05,\"temp\":{\"day\":293.86,\"min\":284.75,\"max\":296.28,\"night\":291.28,\"eve\":296.28,\"morn\":284.75},\"feels_like\":{\"day\":293.03,\"night\":290.32,\"eve\":295.51,\"morn\":283.74},\"pressure\":1019,\"humidity\":40,\"dew_point\":279.41,\"wind_speed\":2.32,\"wind_deg\":177,\"wind_gust\":2.86,\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"overcast clouds\",\"icon\":\"04d\"}],\"clouds\":100,\"pop\":0,\"uvi\":5},{\"dt\":1631181600,\"sunrise\":1631159640,\"sunset\":1631206097,\"moonrise\":1631168820,\"moonset\":1631211120,\"moon_phase\":0.08,\"temp\":{\"day\":296.02,\"min\":286.89,\"max\":297.46,\"night\":290.88,\"eve\":296.83,\"morn\":286.89},\"feels_like\":{\"day\":295.17,\"night\":290.2,\"eve\":296.14,\"morn\":285.73},\"pressure\":1015,\"humidity\":31,\"dew_point\":277.89,\"wind_speed\":3.16,\"wind_deg\":175,\"wind_gust\":4.24,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":59,\"pop\":0.32,\"rain\":0.11,\"uvi\":5}]}";
            var controller = new WeatherForecastController();

            //Act

            var output = controller.ConvertResponseToWeatherForecast(content);

            //Assert

            var weatherForecastForTomorrow = ((WeatherForecast[])output)[0];
            Assert.Equal("Clouds", weatherForecastForTomorrow.Summary);
            Assert.Equal(17, weatherForecastForTomorrow.TemperatureC);
        }
    }
}
